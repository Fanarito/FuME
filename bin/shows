r = require('rethinkdb')
var connection = null;
r.connect({
	host: 'localhost',
	port: 28015
}, function(err, conn) {
	if (err) throw err;
	connection = conn;
});

var movies = r.db('test').table('movies');

var mdb = require('moviedb')('70bc3bd0e08fd826de2ecda0db108941');
var moment = require('moment');
var result;
var poster_download_path;
var backdrop_download_path;

mdb.configuration(function(err, res) {
	if (err) console.log(err);
	poster_download_path = res.images.secure_base_url + res.images.poster_sizes[4];
	backdrop_download_path = res.images.secure_base_url + res.images.backdrop_sizes[3];
});

var fs = require('fs'),
	request = require('request');

var showLibrary = "/media/Drive1/Bio/Series";

var valid_file_extensions = [".mp4", ".webm", ".mkv"];

// Search through all directories + sub directories
var path = require('path');

var walk = function(dir, done) {
	var results = [];
	fs.readdir(dir, function(err, list) {
		if (err) return done(err);
		var i = 0;
		(function next() {
			var file = list[i++];
			if (!file) return done(null, results);
			file = dir + '/' + file;
			fs.stat(file, function(err, stat) {
				if (stat && stat.isDirectory()) {
					walk(file, function(err, res) {
						results = results.concat(res);
						next();
					});
				} else {
					var file_extension = path.extname(file);
					// If the file extension is valid then add file to array
					if (valid_file_extensions.indexOf(file_extension) !== -1) {
						results.push(file);
						var basename = path.basename(file);
						//searchMovie(basename, file);
                        //sleep(3000);
					}
					next();
				}
			});
		})();
	});
};